<!DOCTYPE html>
<html>
<head>
<script src="http://d3js.org/d3.v3.min.js"></script>
 <script src="{{ url_for('static', filename='socket.io-1.2.0.js') }}"></script>
 <style type="text/css">
			
			.axis path,
			.axis line {
				fill: none;
				stroke: black;
				shape-rendering: crispEdges;
			}
			
			.axis text {
				font-family: sans-serif;
				font-size: 11px;
			}

		</style>		
</head>
<body>
<svg class="chart"></svg>
<script>
var socket = io();
var mx,my;
socket.on('s2cS',function(Rdata)
{
	console.log(Rdata);
	//mx=x.invert(d3.mouse(this)[0]);
	//my=y.invert(d3.mouse(this)[1]);
	//data.push([mx,my]); //add last
	mx=Rdata.t;
	my=Rdata.h;
	console.log(mx,Rdata.t,my,Rdata.h)
	data.unshift([mx,my]); //add first
	//draw();
	data.pop(); //remove last
	//data.shift(); //remove first
	draw();
	//console.log("click: "+JSON.stringify(data))
});
//socket.on('s2cT',function(temp){
//	console.log(temp);
// 	mx=temp
// });
// socket.on('s2cH',function(humi){
// 	console.log(humi);
// 	my=humi
// });
var data=[];
for(var i=0;i<100;i++){
	data.push([0,0]);
}

var width = 1024, height = 720, padding = 100;
var mychart = d3.select(".chart")
		.attr("width",width)
		.attr("height",height)
var x = d3.scale.linear()
    .domain([13, 30])
    .range([0, width]);
var y = d3.scale.linear()
    .domain([15, 70])
    .range([0, height]);

//Create the SVG Viewport
/*var svgContainer = d3.select("body").append("svg")
    .attr("width", 1024)
    .attr("height", 600);
 
 //Create the Scale we will use for the Axis
 var axisScale = d3.scale.linear()
    .domain([10, 30])
    .range([0, 1024]);
//Create the Axis
var xAxis = d3.svg.axis()
    .scale(axisScale);


//Create an SVG group Element for the Axis elements and call the xAxis function
var xAxisGroup = svgContainer.append("g")
     .call(xAxis);*/


function draw(){
	var circles=mychart.selectAll("circle")
		.data(data)
	circles
		.transition().duration(5000)
		.attr("fill","#f90")
		.attr("r",10)
		.attr("fill-opacity", function(d,i) { 
			return Math.pow(0.95,i); 
		})
		.attr("cx", function(d,i) { return x(d[0]); })
		.attr("cy", function(d,i) { return y(d[1]); })
	circles.enter().append("circle")
		.transition()
		.attr("r",0)
		.attr("cx", function(d,i) { return x(d[0]); })
		.attr("cy", function(d,i) { return y(d[1]); })
		.attr("fill","#aa0")
		
	circles.exit().transition().duration(1000)
		.attr("r",0)
		.remove();

}
</script>
</body>
</html>